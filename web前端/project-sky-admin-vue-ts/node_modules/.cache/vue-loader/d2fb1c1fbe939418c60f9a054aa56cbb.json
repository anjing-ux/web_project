{"remainingRequest":"G:\\device-management\\project-sky-admin-vue-ts\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!G:\\device-management\\project-sky-admin-vue-ts\\src\\views\\sectionLeader\\deviceReview\\maintenanceAcceptance\\index.vue?vue&type=script&lang=ts&","dependencies":[{"path":"G:\\device-management\\project-sky-admin-vue-ts\\src\\views\\sectionLeader\\deviceReview\\maintenanceAcceptance\\index.vue","mtime":1748349601913},{"path":"G:\\device-management\\project-sky-admin-vue-ts\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"G:\\device-management\\project-sky-admin-vue-ts\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"G:\\device-management\\project-sky-admin-vue-ts\\node_modules\\ts-loader\\index.js","mtime":499162500000},{"path":"G:\\device-management\\project-sky-admin-vue-ts\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"G:\\device-management\\project-sky-admin-vue-ts\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\r\nimport { Component, Vue } from 'vue-property-decorator'\r\nimport HeadLable from '@/components/HeadLable/index.vue'\r\nimport InputAutoComplete from '@/components/InputAutoComplete/index.vue'\r\nimport TabChange from './tabChange.vue'\r\nimport Empty from '@/components/Empty/index.vue'\r\nimport {\r\n  getMaintenanceTaskPage,\r\n  queryMaintenanceDetailById,\r\n  getMaintenanceStatusListBy,\r\n  auditMaintenance2,\r\n  queryMaintenanceTaskById\r\n} from '@/api/maintenance'\r\nimport { status } from 'nprogress'\r\nimport { verify } from 'crypto'\r\n\r\n@Component({\r\n  components: {\r\n    HeadLable,\r\n    InputAutoComplete,\r\n    TabChange,\r\n    Empty,\r\n  },\r\n})\r\nexport default class extends Vue {\r\n  private defaultActivity: any = 0\r\n  private orderStatics = {\r\n    all: 15,\r\n    pending: 3,\r\n    processing: 4,\r\n    waitingClear: 5,\r\n    cleared: 2,\r\n    closed: 1\r\n  }\r\n  private row = {}\r\n  private itemResult = ''\r\n  private maintenanceCode = '' // 保养编号\r\n  private dialogmaintenanceStatus = -1\r\n  private clearDialogVisible = false\r\n  private auditDialogVisible = false // 审核弹窗\r\n  private refuseDialogVisible = false // 审核不通过原因弹窗\r\n  private taskDialogVisible = false // 任务信息弹窗\r\n  private valueTime = []\r\n  private dialogVisible = false // 详情弹窗\r\n  private remark = '' // 备注\r\n  private refuseReason = '' // 审核不通过原因\r\n  private deviceName = ''\r\n  private counts: number = 15\r\n  private page: number = 1\r\n  private pageSize: number = 10\r\n  private tableData = []\r\n  private status = 0\r\n\r\n  private diaForm: any = {} // 修改为对象\r\n  private taskForm: any = {} // 修改为对象\r\n  private isSearch: boolean = false\r\n  private maintenanceStatus = 0 // 列表字段展示所需状态,用于分页请求数据\r\n\r\n  // 审核不通过原因列表\r\n  private refuseFaultList = [\r\n    {\r\n      label: '处理不完善',\r\n      value: '处理不完善',\r\n    },\r\n    {\r\n      label: '信息不完整',\r\n      value: '信息不完整',\r\n    },\r\n    {\r\n      label: '维修措施不当',\r\n      value: '维修措施不当',\r\n    },\r\n    {\r\n      label: '照片不清晰',\r\n      value: '照片不清晰',\r\n    },\r\n    {\r\n      label: '自定义原因',\r\n      value: '自定义原因',\r\n    },\r\n  ]\r\n\r\n  // 保养结果列表\r\n  private itemResultList = [\r\n    {\r\n      label: '正常',\r\n      value: '正常',\r\n    },\r\n    {\r\n      label: '异常',\r\n      value: '异常',\r\n    },\r\n  ]\r\n\r\n\r\n\r\n  \r\n  // 任务状态列表\r\n  private taskStatusList = [\r\n    {\r\n      label: '执行中',\r\n      value: 1,\r\n    },\r\n    {\r\n      label: '待验收',\r\n      value: 2,\r\n    },\r\n    {\r\n      label: '已验收',\r\n      value: 3,\r\n    },\r\n    {\r\n      label: '已销号',\r\n      value: 4,\r\n    },\r\n    {\r\n      label: '被驳回',\r\n      value: 5,\r\n    }\r\n  ]\r\n\r\n  private maintenanceStatusList = [\r\n    {\r\n      label: '待验收',\r\n      value: 2,\r\n    },\r\n    {\r\n      label: '验收完成',\r\n      value: 3,\r\n    },\r\n    \r\n  ]\r\n  \r\n  // 工区列表（示例数据）\r\n  private areaList = [\r\n    { id: 1, name: '工区A' },\r\n    { id: 2, name: '工区B' },\r\n    { id: 3, name: '工区C' }\r\n  ]\r\n  \r\n  // 班组列表（示例数据）\r\n  private teamList = [\r\n    { id: 1, name: '班组A' },\r\n    { id: 2, name: '班组B' },\r\n    { id: 3, name: '班组C' }\r\n  ]\r\n\r\n  created() {\r\n    this.init(Number(this.$route.query.status) || 0)\r\n  }\r\n\r\n  mounted() {\r\n    if (\r\n      this.$route.query.maintenanceId &&\r\n      this.$route.query.maintenanceId !== 'undefined'\r\n    ) {\r\n      this.goDetail(this.$route.query.maintenanceId, 2)\r\n    }\r\n    if (this.$route.query.status) {\r\n      this.defaultActivity = Number(this.$route.query.status)\r\n    }\r\n  }\r\n  \r\n  // 获取工区名称\r\n  private getAreaName(areaId: number): string {\r\n    const area = this.areaList.find(item => item.id === areaId)\r\n    return area ? area.name : '未知工区'\r\n  }\r\n  \r\n  // 获取班组名称\r\n  private getTeamName(teamId: number): string {\r\n    const team = this.teamList.find(item => item.id === teamId)\r\n    return team ? team.name : '未知班组'\r\n  }\r\n  \r\n\r\n  // 获取保养结果\r\n  private getitemResult(row: any): string {\r\n    const type = this.itemResultList.find(item => item.value === row.itemResult)\r\n    return type ? type.label : '未知类型'\r\n  }\r\n  \r\n\r\n  // 获取保养状态\r\n  private getmaintenanceStatus(row: any): string {\r\n    const status = this.maintenanceStatusList.find(item => item.value === row.status)\r\n    return status ? status.label : '未知状态'\r\n  }\r\n  \r\n  // 获取任务状态文本\r\n  private getTaskStatusText(status: number): string {\r\n    const statusItem = this.taskStatusList.find(item => item.value === status)\r\n    return statusItem ? statusItem.label : '未知状态'\r\n  }\r\n  \r\n  // 初始化数据\r\n  private init(activeIndex: number, isSearch: boolean = false) {\r\n    console.log('初始化数据当前activeIndex:', activeIndex)\r\n    this.maintenanceStatus = activeIndex\r\n    this.isSearch = isSearch\r\n    const params = {\r\n      auditStatus: activeIndex,\r\n      page: this.page,\r\n      pageSize: this.pageSize,\r\n      deviceName: this.deviceName,\r\n      startTime: this.valueTime && this.valueTime.length ? this.valueTime[0] : null,\r\n      completeTime: this.valueTime && this.valueTime.length ? this.valueTime[1] : null,\r\n    }\r\n    \r\n    getMaintenanceTaskPage(params).then(res => {\r\n      if (res.data.code === 1) {\r\n\r\n        this.tableData = res.data.data.records || 0\r\n        this.counts = res.data.total\r\n      } else {\r\n        this.$message.error(res.data.msg || '获取数据失败')\r\n      }\r\n    }).catch(() => {\r\n      // 模拟数据，实际开发中可删除\r\n      this.$message.error('未知错误请联系管理员')\r\n    })\r\n  }\r\n  \r\n  // 初始化函数（用于回车搜索）\r\n  private initFun(status: number) {\r\n    this.init(status, true)\r\n  }\r\n  \r\n  //管理标签页点击事件\r\n  change(activeIndex) {\r\n    if (activeIndex === this.maintenanceStatus) return\r\n    this.init(activeIndex)\r\n    this.valueTime = []\r\n    //this.dialogPurchaseStatus = 0\r\n    this.$router.push('/sectionLeader/deviceReview/maintenanceAcceptance')\r\n    console.log(activeIndex, '接收到了子组件的index')\r\n  }\r\n\r\n  \r\n  // 处理页码变化\r\n  private handleCurrentChange(val: number) {\r\n    this.page = val\r\n    this.init(this.maintenanceStatus)\r\n  }\r\n  \r\n  // 处理每页条数变化\r\n  private handleSizeChange(val: number) {\r\n    this.pageSize = val\r\n    this.page = 1\r\n    this.init(this.maintenanceStatus)\r\n  }\r\n  \r\n  // 关闭弹窗\r\n  private handleClose() {\r\n    this.dialogVisible = false\r\n  }\r\n  \r\n\r\n  \r\n  // 查看详情\r\n  private goDetail(maintenanceId: string, status: number, row: any = {}) {\r\n    this.row = row\r\n    this.dialogmaintenanceStatus = status\r\n    this.dialogVisible = true\r\n    \r\n    // 获取保养详情\r\n    queryMaintenanceDetailById(maintenanceId).then(res => {\r\n      if (res.data.code === 1) {\r\n        this.diaForm = res.data.data\r\n      } else {\r\n        this.$message.error(res.data.msg || '获取详情失败')\r\n      }\r\n    }).catch(() => {\r\n      // 模拟数据，实际开发中可删除\r\n      this.$message.error('未知错误请联系管理员')\r\n    })\r\n  }\r\n  \r\n  // 审核保养\r\n  private auditMaintenance2(row: any) {\r\n    this.row = row\r\n    this.dialogmaintenanceStatus = row.status\r\n    this.auditDialogVisible = true\r\n    // 获取保养详情\r\n    queryMaintenanceDetailById(row.maintenanceId).then(res => {\r\n      if (res.data.code === 1) {\r\n        this.diaForm = res.data.data\r\n      } else {\r\n        this.$message.error(res.data.msg || '获取详情失败')\r\n      }\r\n    }).catch(() => {\r\n      // 模拟数据，实际开发中可删除\r\n      this.$message.error('未知错误请联系管理员')\r\n    })\r\n  }\r\n  \r\n  // 审核不通过\r\n  private refuseFault(row: any) {\r\n    this.row = row\r\n    this.refuseDialogVisible = true\r\n  }\r\n  \r\n  // 确认审核不通过\r\n  private confirmRefuse() {\r\n    if (!this.refuseReason) {\r\n      this.$message.error('请选择审核不通过原因')\r\n      return\r\n    }\r\n    \r\n   \r\n    const params = {\r\n      approved: false,\r\n      maintenanceId: this.row.maintenanceId,\r\n      satisfactionScore: null,\r\n      verifyId: 1,\r\n      verifyOpinion: this.remark == '' ? this.refuseReason : this.remark,\r\n    };\r\n    \r\n    auditMaintenance2(params).then(res => {\r\n      if (res.data.code === 1) {\r\n        this.$message.success('审核通过成功！')\r\n        this.clearDialogVisible = false\r\n        this.dialogVisible = false\r\n        this.refuseDialogVisible = false\r\n        this.auditDialogVisible = false\r\n        this.remark = ''\r\n        this.row = {}\r\n        this.init(this.maintenanceStatus)\r\n      } else {\r\n        this.$message.error(res.data.msg || '操作失败')\r\n      }\r\n    }).catch(() => {\r\n      this.$message.error('服务器繁忙')\r\n      this.clearDialogVisible = false\r\n      this.dialogVisible = false\r\n      this.remark = ''\r\n      this.init(this.maintenanceStatus)\r\n    })\r\n  }\r\n  \r\n\r\n  \r\n  // 审核通过确认框\r\n  private confirmPassAudit(row: any) {\r\n    this.row = row\r\n    this.clearDialogVisible = true\r\n  }\r\n  \r\n  // 确认审核通过！\r\n  private passAudit() {\r\n    if (!this.remark) {\r\n      this.$message.error('请填写销号备注')\r\n      return;\r\n    }\r\n\r\n\r\n    const params = {\r\n      approved: true,\r\n      maintenanceId: this.row.maintenanceId,\r\n      satisfactionScore: null,\r\n      verifyId: 1,\r\n      verifyOpinion: this.remark,\r\n    };\r\n    \r\n    auditMaintenance2(params).then(res => {\r\n      if (res.data.code === 1) {\r\n        this.$message.success('审核通过成功！')\r\n        this.clearDialogVisible = false\r\n        this.dialogVisible = false\r\n        this.auditDialogVisible = false\r\n        this.remark = ''\r\n        this.row = {}\r\n        this.init(this.maintenanceStatus)\r\n      } else {\r\n        this.$message.error(res.data.msg || '操作失败')\r\n      }\r\n    }).catch(() => {\r\n      this.$message.success('销号成功')\r\n      this.clearDialogVisible = false\r\n      this.dialogVisible = false\r\n      this.remark = ''\r\n      this.init(this.maintenanceStatus)\r\n    })\r\n  }\r\n  \r\n  // 查看任务信息\r\n  private viewTaskInfo(row: any) {\r\n    this.taskDialogVisible = true\r\n    // 获取任务信息\r\n    queryMaintenanceTaskById(row.maintenanceId).then(res => {\r\n      if (res.data.code === 1) {\r\n        this.taskForm = res.data.data\r\n      } else {\r\n        this.$message.error(res.data.msg || '获取任务信息失败')\r\n      }\r\n    }).catch(() => {\r\n      // 模拟任务数据\r\n      this.taskForm = {\r\n        taskId: 1,\r\n        taskCode: 'TASK20230001',\r\n        maintenanceId: row.maintenanceId,\r\n        maintenanceCode: row.maintenanceCode,\r\n        deviceId: row.deviceId,\r\n        deviceCode: row.deviceCode,\r\n        deviceName: row.deviceName,\r\n        taskName: '设备保养维修任务',\r\n        startTime: '2023-05-10 10:00:00',\r\n        endTime: '2023-05-10 18:00:00',\r\n        executorId: 2001,\r\n        executorName: '李四',\r\n        status: 2,\r\n        completeTime: '2023-05-10 16:30:00',\r\n        closeTime: null,\r\n        areaId: row.areaId,\r\n        teamId: row.teamId,\r\n        createTime: '2023-05-10 09:45:00',\r\n        updateTime: '2023-05-10 16:30:00'\r\n      }\r\n    })\r\n  }\r\n  \r\n  // 关闭任务信息弹窗\r\n  private handleTaskClose() {\r\n    this.taskDialogVisible = false\r\n    this.taskForm = {}\r\n  }\r\n  \r\n  // 关闭审核弹窗\r\n  private handleAuditClose() {\r\n    this.auditDialogVisible = false\r\n    this.diaForm = {}\r\n  }\r\n}\r\n",{"version":3,"sources":["index.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAkcA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;AAKA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;;;AAIA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;AAIA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA","file":"index.vue","sourceRoot":"src/views/sectionLeader/deviceReview/maintenanceAcceptance","sourcesContent":["<template>\r\n  <div class=\"dashboard-container\">\r\n    <TabChange :order-statics=\"orderStatics\" :default-activity=\"defaultActivity\" @tabChange=\"change\" />\r\n    <div class=\"container\" :class=\"{ hContainer: tableData.length }\">\r\n      <!-- 搜索项 -->\r\n      <div class=\"tableBar\">\r\n        <label style=\"margin-right: 10px\">设备名称：</label>\r\n        <el-input v-model=\"deviceName\" placeholder=\"请填写设备名称：\" style=\"width: 15%\" clearable\r\n          @clear=\"init(maintenanceStatus)\" @keyup.enter.native=\"initFun(maintenanceStatus)\" />\r\n        <label style=\"margin-left: 20px\">开始时间：</label>\r\n        <el-date-picker v-model=\"valueTime\" clearable value-format=\"yyyy-MM-dd HH:mm:ss\" range-separator=\"至\"\r\n          :default-time=\"['00:00:00', '23:59:59']\" type=\"daterange\" start-placeholder=\"开始日期\" end-placeholder=\"结束日期\"\r\n          style=\"width: 25%; margin-left: 10px\" @clear=\"init(maintenanceStatus)\" />\r\n        <el-button class=\"normal-btn continue\" @click=\"init(maintenanceStatus, true)\">\r\n          查询\r\n        </el-button>\r\n      </div>\r\n      <el-table v-if=\"tableData.length\" :data=\"tableData\" stripe class=\"tableBox\">\r\n        <el-table-column key=\"maintenanceCode\" prop=\"maintenanceCode\" label=\"保养编号\" />\r\n        <el-table-column key=\"deviceName\" prop=\"deviceName\" label=\"设备名称\" />\r\n        <el-table-column key=\"itemResult\" prop=\"itemResult\" label=\"保养结果\">\r\n          <template slot-scope=\"{ row }\">\r\n            <span>{{ getitemResult(row) }}</span>\r\n          </template>\r\n        </el-table-column>\r\n        <el-table-column v-if=\"[0].includes(maintenanceStatus)\" key=\"status\" prop=\"status\" label=\"状态信息\">\r\n          <template slot-scope=\"{ row }\">\r\n            <span>{{ getmaintenanceStatus(row) }}</span>\r\n          </template>\r\n        </el-table-column>\r\n        <el-table-column key=\"startTime\" prop=\"startTime\" label=\"开始时间\" />\r\n        <el-table-column key=\"operatorName\" prop=\"operatorName\" label=\"操作人姓名\" />\r\n        <el-table-column v-if=\"[2, 3].includes(maintenanceStatus)\" key=\"completeTime\" prop=\"completeTime\" label=\"完成时间\" />\r\n        <el-table-column v-if=\"[4].includes(maintenanceStatus)\" key=\"closeTime\" prop=\"closeTime\" label=\"关闭时间\" />\r\n        <el-table-column prop=\"btn\" label=\"操作\" align=\"center\"\r\n          :class-name=\"maintenanceStatus === 1 ? 'operate' : 'otherOperate'\" :min-width=\"[-1, 0].includes(maintenanceStatus)\r\n            ? 130\r\n            : [1, 2].includes(maintenanceStatus)\r\n              ? 140\r\n              : 'auto'\r\n            \">\r\n          <template slot-scope=\"{ row }\">\r\n            <div class=\"before\">\r\n              <el-button type=\"text\" class=\"blueBug non\" @click=\"goDetail(row.maintenanceId, row.status, row)\">\r\n                查看\r\n              </el-button>\r\n            </div>\r\n            <div class=\"middle\">\r\n              <el-button v-if=\"[2].includes(row.status) && [2].includes(row.verifyStep)\" type=\"text\" class=\"delBut\"\r\n                @click=\"auditMaintenance2(row)\">\r\n                审核\r\n              </el-button>\r\n            </div>\r\n            <div class=\"after\">\r\n              <el-button type=\"text\" class=\"greenBug non\" @click=\"viewTaskInfo(row)\">\r\n                查看任务信息\r\n              </el-button>\r\n            </div>\r\n          </template>\r\n        </el-table-column>\r\n      </el-table>\r\n      <Empty v-else :is-search=\"isSearch\" />\r\n      <el-pagination v-if=\"counts > 10\" class=\"pageList\" :page-sizes=\"[10, 20, 30, 40]\" :page-size=\"pageSize\"\r\n        layout=\"total, sizes, prev, pager, next, jumper\" :total=\"counts\" @size-change=\"handleSizeChange\"\r\n        @current-change=\"handleCurrentChange\" />\r\n    </div>\r\n\r\n    <!-- 查看弹框部分 -->\r\n    <el-dialog title=\"保养详细信息\" :visible.sync=\"dialogVisible\" width=\"53%\" :before-close=\"handleClose\"\r\n      class=\"order-dialog\">\r\n      <el-scrollbar style=\"height: 100%\">\r\n        <!-- 顶部信息 -->\r\n        <div class=\"order-top\">\r\n          <div>\r\n            <div style=\"display: inline-block\">\r\n              <label style=\"font-size: 16px\">保养编号：</label>\r\n              <div class=\"order-num\">\r\n                {{ diaForm.maintenanceCode }}\r\n              </div>\r\n            </div>\r\n            <div style=\"display: inline-block\" class=\"order-status\" :class=\"{ status3: true }\">\r\n              {{\r\n                maintenanceStatusList.filter((item) => item.value === dialogmaintenanceStatus).length > 0 \r\n                ? maintenanceStatusList.filter((item) => item.value === dialogmaintenanceStatus)[0].label \r\n                : '未知状态'\r\n              }}\r\n            </div>\r\n          </div>\r\n          <p><label>创建时间：</label>{{ diaForm.createTime }}</p>\r\n        </div>\r\n\r\n        <!-- 中间信息 -->\r\n        <div class=\"order-middle\">\r\n          <!-- 保养信息 -->\r\n          <div class=\"dish-label\">保养信息</div>\r\n          <div class=\"user-info\">\r\n            <div class=\"user-info-box\">\r\n              <div class=\"user-name\">\r\n                <label>项目名称：</label>\r\n                <span>{{ diaForm.itemName }}</span>\r\n              </div>\r\n              <div class=\"user-name\">\r\n                <label>操作人姓名：</label>\r\n                <span>{{ diaForm.operatorName }}</span>\r\n              </div>\r\n\r\n              <div class=\"user-getTime\">\r\n                <label>开始时间：</label>\r\n                <span>{{ diaForm.startTime }}</span>\r\n              </div>\r\n            </div>\r\n            \r\n            <!-- 新增修复前后照片 -->\r\n            <div class=\"user-remark\" v-if=\"diaForm.beforePhoto\">\r\n              <div>保养前照片：</div>\r\n              <div class=\"photo-container\">\r\n                <div v-for=\"(photo, index) in diaForm.beforePhoto.split(',')\" :key=\"'before-'+index\" class=\"photo-item\">\r\n                  <el-image :src=\"photo\" alt=\"保养前照片：\" :preview-src-list=\"diaForm.beforePhoto.split(',')\" fit=\"cover\" />\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            <div class=\"user-remark\" v-if=\"diaForm.afterPhoto\">\r\n              <div>保养后照片：</div>\r\n              <div class=\"photo-container\">\r\n                <div v-for=\"(photo, index) in diaForm.afterPhoto.split(',')\" :key=\"'after-'+index\" class=\"photo-item\">\r\n                  <el-image :src=\"photo\" alt=\"保养后照片：\" :preview-src-list=\"diaForm.afterPhoto.split(',')\" fit=\"cover\" />\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n          </div>\r\n\r\n          <div class=\"dish-label\">设备信息</div>\r\n          <!-- 设备信息 -->\r\n          <div class=\"user-info\">\r\n            <div class=\"user-info-box\">\r\n              <div class=\"user-name\">\r\n                <label>设备编号：</label>\r\n                <span>{{ diaForm.deviceCode }}</span>\r\n              </div>\r\n\r\n              <div class=\"user-name\">\r\n                <label>设备名称：</label>\r\n                <span>{{ diaForm.deviceName }}</span>\r\n              </div>\r\n              \r\n              <!-- 新增工区和班组信息 -->\r\n              <div class=\"user-name\" v-if=\"diaForm.areaId\">\r\n                <label>工区：</label>\r\n                <span>{{ getAreaName(diaForm.areaId) }}</span>\r\n              </div>\r\n              \r\n              <div class=\"user-name\" v-if=\"diaForm.teamId\">\r\n                <label>班组：</label>\r\n                <span>{{ getTeamName(diaForm.teamId) }}</span>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        <!-- 底部信息 -->\r\n        <div class=\"order-bottom\">\r\n          <div class=\"amount-label\">处理信息</div>\r\n          <div class=\"amount-info\">\r\n            <div class=\"user-remark\">\r\n              <div class=\"approver-time\">\r\n                <div>操作人：</div>\r\n                <span>{{ diaForm.operatorName }}</span>\r\n              </div>\r\n\r\n              <div class=\"approver-time\">\r\n                <div>完成时间：</div>\r\n                <span>{{ diaForm.completeTime }}</span>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n      </el-scrollbar>\r\n      <span slot=\"footer\" class=\"dialog-footer\">\r\n        <el-button @click=\"dialogVisible = false\">返 回</el-button>\r\n      </span>\r\n    </el-dialog>\r\n    \r\n    <!-- 审核确认弹窗 -->\r\n    <el-dialog title=\"审核通过确认\" :visible.sync=\"clearDialogVisible\" width=\"42%\"\r\n      :before-close=\"() => ((clearDialogVisible = false), (remark = ''))\" class=\"cancelDialog\">\r\n      <el-form label-width=\"90px\">\r\n        <el-form-item label=\"审核备注：\">\r\n          <el-input v-model.trim=\"remark\" type=\"textarea\" placeholder=\"请填写审核备注（限50字内）\" maxlength=\"50\" />\r\n        </el-form-item>\r\n      </el-form>\r\n      <span slot=\"footer\" class=\"dialog-footer\">\r\n        <el-button @click=\"; (clearDialogVisible = false), (remark = '')\">取 消</el-button>\r\n        <el-button type=\"primary\" @click=\"passAudit\">确 定</el-button>\r\n      </span>\r\n    </el-dialog>\r\n    \r\n    <!-- 审核弹窗 -->\r\n    <el-dialog title=\"巡检审核\" :visible.sync=\"auditDialogVisible\" width=\"53%\" :before-close=\"handleAuditClose\"\r\n      class=\"order-dialog\">\r\n      <el-scrollbar style=\"height: 100%\">\r\n        <!-- 顶部信息 -->\r\n        <div class=\"order-top\">\r\n          <div>\r\n            <div style=\"display: inline-block\">\r\n              <label style=\"font-size: 16px\">保养编号：</label>\r\n              <div class=\"order-num\">\r\n                {{ diaForm.maintenanceCode }}\r\n              </div>\r\n            </div>\r\n            <div style=\"display: inline-block\" class=\"order-status\" :class=\"{ status3: true }\">\r\n              {{\r\n                maintenanceStatusList.filter((item) => item.value === dialogmaintenanceStatus).length > 0 \r\n                ? maintenanceStatusList.filter((item) => item.value === dialogmaintenanceStatus)[0].label \r\n                : '未知状态'\r\n              }}\r\n            </div>\r\n          </div>\r\n          <p><label>创建时间：</label>{{ diaForm.createTime }}</p>\r\n        </div>\r\n\r\n        <!-- 中间信息 -->\r\n        <div class=\"order-middle\">\r\n          <!-- 保养信息 -->\r\n          <div class=\"dish-label\">保养信息</div>\r\n          <div class=\"user-info\">\r\n            <div class=\"user-info-box\">\r\n              <div class=\"user-name\">\r\n                <label>操作人姓名：</label>\r\n                <span>{{ diaForm.operatorName }}</span>\r\n              </div>\r\n\r\n              <div class=\"user-phone\">\r\n                <label>报修人电话：</label>\r\n                <span>{{ diaForm.reporterPhone }}</span>\r\n              </div>\r\n\r\n              <div class=\"user-getTime\">\r\n                <label>开始时间：</label>\r\n                <span>{{ diaForm.startTime }}</span>\r\n              </div>\r\n\r\n            </div>\r\n\r\n            \r\n            <!-- 修复前后照片 -->\r\n                        <div class=\"user-remark\" v-if=\"diaForm.beforePhoto\">\r\n              <div>保养前照片：</div>\r\n              <div class=\"photo-container\">\r\n                <div v-for=\"(photo, index) in diaForm.beforePhoto.split(',')\" :key=\"'before-'+index\" class=\"photo-item\">\r\n                  <el-image :src=\"photo\" alt=\"保养前照片：\" :preview-src-list=\"diaForm.beforePhoto.split(',')\" fit=\"cover\" />\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            <div class=\"user-remark\" v-if=\"diaForm.afterPhoto\">\r\n              <div>保养后照片：</div>\r\n              <div class=\"photo-container\">\r\n                <div v-for=\"(photo, index) in diaForm.afterPhoto.split(',')\" :key=\"'after-'+index\" class=\"photo-item\">\r\n                  <el-image :src=\"photo\" alt=\"保养后照片：\" :preview-src-list=\"diaForm.afterPhoto.split(',')\" fit=\"cover\" />\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          <div class=\"dish-label\">设备信息</div>\r\n          <!-- 设备信息 -->\r\n          <div class=\"user-info\">\r\n            <div class=\"user-info-box\">\r\n              <div class=\"user-name\">\r\n                <label>设备编号：</label>\r\n                <span>{{ diaForm.deviceCode }}</span>\r\n              </div>\r\n\r\n              <div class=\"user-name\">\r\n                <label>设备名称：</label>\r\n                <span>{{ diaForm.deviceName }}</span>\r\n              </div>\r\n              \r\n              <!-- 工区和班组信息 -->\r\n              <div class=\"user-name\" v-if=\"diaForm.areaId\">\r\n                <label>工区：</label>\r\n                <span>{{ getAreaName(diaForm.areaId) }}</span>\r\n              </div>\r\n              \r\n              <div class=\"user-name\" v-if=\"diaForm.teamId\">\r\n                <label>班组：</label>\r\n                <span>{{ getTeamName(diaForm.teamId) }}</span>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        <!-- 底部信息 -->\r\n        <div class=\"order-bottom\">\r\n          <div class=\"amount-label\">处理信息</div>\r\n          <div class=\"amount-info\">\r\n            <div class=\"user-remark\">\r\n              <div class=\"approver-time\">\r\n                <div>操作人：</div>\r\n                <span>{{ diaForm.processorName }}</span>\r\n              </div>\r\n              <div class=\"approver-time\">\r\n                <div>接单时间：</div>\r\n                <span>{{ diaForm.processTime }}</span>\r\n              </div>\r\n              <div class=\"approver-time\">\r\n                <div>完成时间：</div>\r\n                <span>{{ diaForm.completeTime }}</span>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </el-scrollbar>\r\n      <span slot=\"footer\" class=\"dialog-footer\">\r\n        <el-button @click=\"auditDialogVisible = false\">返 回</el-button>\r\n        <el-button @click=\"refuseFault(row)\">审核不通过</el-button>\r\n        <el-button type=\"primary\" @click=\"confirmPassAudit(row)\">审核通过</el-button>\r\n        <el-button type=\"primary\" @click=\"viewTaskInfo(row)\">查看任务信息</el-button>\r\n      </span>\r\n    </el-dialog>\r\n    \r\n    <!-- 审核不通过原因弹窗 -->\r\n    <el-dialog title=\"审核不通过原因\" :visible.sync=\"refuseDialogVisible\" width=\"42%\"\r\n      :before-close=\"() => ((refuseDialogVisible = false), (refuseReason = ''))\" class=\"cancelDialog\">\r\n      <el-form label-width=\"140px\">\r\n        <el-form-item label=\"审核不通过原因：\">\r\n          <el-select v-model=\"refuseReason\" placeholder=\"请选择审核不通过原因\">\r\n            <el-option v-for=\"(item, index) in refuseFaultList\" :key=\"index\" :label=\"item.label\"\r\n              :value=\"item.label\" />\r\n          </el-select>\r\n        </el-form-item>\r\n        <el-form-item v-if=\"refuseReason === '自定义原因'\" label=\"原因：\">\r\n          <el-input v-model.trim=\"remark\" type=\"textarea\" placeholder=\"请填写您审核不通过的原因（限20字内）\"\r\n            maxlength=\"20\" />\r\n        </el-form-item>\r\n      </el-form>\r\n      <span slot=\"footer\" class=\"dialog-footer\">\r\n        <el-button @click=\"; (refuseDialogVisible = false), (refuseReason = '')\">取 消</el-button>\r\n        <el-button type=\"primary\" @click=\"confirmRefuse\">确 定</el-button>\r\n      </span>\r\n    </el-dialog>\r\n    \r\n    <!-- 查看任务信息弹窗 -->\r\n    <el-dialog title=\"保养处理任务信息\" :visible.sync=\"taskDialogVisible\" width=\"53%\" :before-close=\"handleTaskClose\"\r\n      class=\"order-dialog\">\r\n      <el-scrollbar style=\"height: 100%\">\r\n        <!-- 顶部信息 -->\r\n        <div class=\"order-top\">\r\n          <div>\r\n            <div style=\"display: inline-block\">\r\n              <label style=\"font-size: 16px\">任务编号：</label>\r\n              <div class=\"order-num\">\r\n                {{ taskForm.taskCode }}\r\n              </div>\r\n            </div>\r\n            <div style=\"display: inline-block\" class=\"order-status\" :class=\"{ status3: true }\">\r\n              {{ getTaskStatusText(taskForm.status) }}\r\n            </div>\r\n          </div>\r\n          <p><label>创建时间：</label>{{ taskForm.createTime }}</p>\r\n        </div>\r\n\r\n        <!-- 中间信息 -->\r\n        <div class=\"order-middle\">\r\n          <!-- 任务基本信息 -->\r\n          <div class=\"dish-label\">任务基本信息</div>\r\n          <div class=\"user-info\">\r\n            <div class=\"user-info-box\">\r\n              <div class=\"user-name\">\r\n                <label>任务名称：</label>\r\n                <span>{{ taskForm.taskName }}</span>\r\n              </div>\r\n              \r\n              <div class=\"user-getTime\">\r\n                <label>开始时间：</label>\r\n                <span>{{ taskForm.startTime }}</span>\r\n              </div>\r\n              \r\n              <div class=\"user-getTime\">\r\n                <label>结束时间：</label>\r\n                <span>{{ taskForm.endTime }}</span>\r\n              </div>\r\n              \r\n              <div class=\"user-name\">\r\n                <label>执行人：</label>\r\n                <span>{{ taskForm.executorName }}</span>\r\n              </div>\r\n              \r\n              <div class=\"user-getTime\">\r\n                <label>完成时间：</label>\r\n                <span>{{ taskForm.completeTime }}</span>\r\n              </div>\r\n              \r\n              <div class=\"user-getTime\">\r\n                <label>关闭时间：</label>\r\n                <span>{{ taskForm.closeTime }}</span>\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          <!-- 关联保养信息 -->\r\n          <div class=\"dish-label\">关联保养信息</div>\r\n          <div class=\"user-info\">\r\n            <div class=\"user-info-box\">\r\n              <div class=\"user-name\">\r\n                <label>保养编号：</label>\r\n                <span>{{ taskForm.maintenanceCode }}</span>\r\n              </div>\r\n              \r\n              <div class=\"user-name\">\r\n                <label>设备编号：</label>\r\n                <span>{{ taskForm.deviceCode }}</span>\r\n              </div>\r\n              \r\n              <div class=\"user-name\">\r\n                <label>设备名称：</label>\r\n                <span>{{ taskForm.deviceName }}</span>\r\n              </div>\r\n            </div>\r\n          </div>\r\n          \r\n          <!-- 工区班组信息 -->\r\n          <div class=\"dish-label\">所属信息</div>\r\n          <div class=\"user-info\">\r\n            <div class=\"user-info-box\">\r\n              <div class=\"user-name\">\r\n                <label>工区：</label>\r\n                <span>{{ getAreaName(taskForm.areaId) }}</span>\r\n              </div>\r\n              \r\n              <div class=\"user-name\">\r\n                <label>班组：</label>\r\n                <span>{{ getTeamName(taskForm.teamId) }}</span>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </el-scrollbar>\r\n      <span slot=\"footer\" class=\"dialog-footer\">\r\n        <el-button @click=\"taskDialogVisible = false\">返 回</el-button>\r\n      </span>\r\n    </el-dialog>\r\n  </div>\r\n</template>\r\n\r\n\r\n<script lang=\"ts\">\r\nimport { Component, Vue } from 'vue-property-decorator'\r\nimport HeadLable from '@/components/HeadLable/index.vue'\r\nimport InputAutoComplete from '@/components/InputAutoComplete/index.vue'\r\nimport TabChange from './tabChange.vue'\r\nimport Empty from '@/components/Empty/index.vue'\r\nimport {\r\n  getMaintenanceTaskPage,\r\n  queryMaintenanceDetailById,\r\n  getMaintenanceStatusListBy,\r\n  auditMaintenance2,\r\n  queryMaintenanceTaskById\r\n} from '@/api/maintenance'\r\nimport { status } from 'nprogress'\r\nimport { verify } from 'crypto'\r\n\r\n@Component({\r\n  components: {\r\n    HeadLable,\r\n    InputAutoComplete,\r\n    TabChange,\r\n    Empty,\r\n  },\r\n})\r\nexport default class extends Vue {\r\n  private defaultActivity: any = 0\r\n  private orderStatics = {\r\n    all: 15,\r\n    pending: 3,\r\n    processing: 4,\r\n    waitingClear: 5,\r\n    cleared: 2,\r\n    closed: 1\r\n  }\r\n  private row = {}\r\n  private itemResult = ''\r\n  private maintenanceCode = '' // 保养编号\r\n  private dialogmaintenanceStatus = -1\r\n  private clearDialogVisible = false\r\n  private auditDialogVisible = false // 审核弹窗\r\n  private refuseDialogVisible = false // 审核不通过原因弹窗\r\n  private taskDialogVisible = false // 任务信息弹窗\r\n  private valueTime = []\r\n  private dialogVisible = false // 详情弹窗\r\n  private remark = '' // 备注\r\n  private refuseReason = '' // 审核不通过原因\r\n  private deviceName = ''\r\n  private counts: number = 15\r\n  private page: number = 1\r\n  private pageSize: number = 10\r\n  private tableData = []\r\n  private status = 0\r\n\r\n  private diaForm: any = {} // 修改为对象\r\n  private taskForm: any = {} // 修改为对象\r\n  private isSearch: boolean = false\r\n  private maintenanceStatus = 0 // 列表字段展示所需状态,用于分页请求数据\r\n\r\n  // 审核不通过原因列表\r\n  private refuseFaultList = [\r\n    {\r\n      label: '处理不完善',\r\n      value: '处理不完善',\r\n    },\r\n    {\r\n      label: '信息不完整',\r\n      value: '信息不完整',\r\n    },\r\n    {\r\n      label: '维修措施不当',\r\n      value: '维修措施不当',\r\n    },\r\n    {\r\n      label: '照片不清晰',\r\n      value: '照片不清晰',\r\n    },\r\n    {\r\n      label: '自定义原因',\r\n      value: '自定义原因',\r\n    },\r\n  ]\r\n\r\n  // 保养结果列表\r\n  private itemResultList = [\r\n    {\r\n      label: '正常',\r\n      value: '正常',\r\n    },\r\n    {\r\n      label: '异常',\r\n      value: '异常',\r\n    },\r\n  ]\r\n\r\n\r\n\r\n  \r\n  // 任务状态列表\r\n  private taskStatusList = [\r\n    {\r\n      label: '执行中',\r\n      value: 1,\r\n    },\r\n    {\r\n      label: '待验收',\r\n      value: 2,\r\n    },\r\n    {\r\n      label: '已验收',\r\n      value: 3,\r\n    },\r\n    {\r\n      label: '已销号',\r\n      value: 4,\r\n    },\r\n    {\r\n      label: '被驳回',\r\n      value: 5,\r\n    }\r\n  ]\r\n\r\n  private maintenanceStatusList = [\r\n    {\r\n      label: '待验收',\r\n      value: 2,\r\n    },\r\n    {\r\n      label: '验收完成',\r\n      value: 3,\r\n    },\r\n    \r\n  ]\r\n  \r\n  // 工区列表（示例数据）\r\n  private areaList = [\r\n    { id: 1, name: '工区A' },\r\n    { id: 2, name: '工区B' },\r\n    { id: 3, name: '工区C' }\r\n  ]\r\n  \r\n  // 班组列表（示例数据）\r\n  private teamList = [\r\n    { id: 1, name: '班组A' },\r\n    { id: 2, name: '班组B' },\r\n    { id: 3, name: '班组C' }\r\n  ]\r\n\r\n  created() {\r\n    this.init(Number(this.$route.query.status) || 0)\r\n  }\r\n\r\n  mounted() {\r\n    if (\r\n      this.$route.query.maintenanceId &&\r\n      this.$route.query.maintenanceId !== 'undefined'\r\n    ) {\r\n      this.goDetail(this.$route.query.maintenanceId, 2)\r\n    }\r\n    if (this.$route.query.status) {\r\n      this.defaultActivity = Number(this.$route.query.status)\r\n    }\r\n  }\r\n  \r\n  // 获取工区名称\r\n  private getAreaName(areaId: number): string {\r\n    const area = this.areaList.find(item => item.id === areaId)\r\n    return area ? area.name : '未知工区'\r\n  }\r\n  \r\n  // 获取班组名称\r\n  private getTeamName(teamId: number): string {\r\n    const team = this.teamList.find(item => item.id === teamId)\r\n    return team ? team.name : '未知班组'\r\n  }\r\n  \r\n\r\n  // 获取保养结果\r\n  private getitemResult(row: any): string {\r\n    const type = this.itemResultList.find(item => item.value === row.itemResult)\r\n    return type ? type.label : '未知类型'\r\n  }\r\n  \r\n\r\n  // 获取保养状态\r\n  private getmaintenanceStatus(row: any): string {\r\n    const status = this.maintenanceStatusList.find(item => item.value === row.status)\r\n    return status ? status.label : '未知状态'\r\n  }\r\n  \r\n  // 获取任务状态文本\r\n  private getTaskStatusText(status: number): string {\r\n    const statusItem = this.taskStatusList.find(item => item.value === status)\r\n    return statusItem ? statusItem.label : '未知状态'\r\n  }\r\n  \r\n  // 初始化数据\r\n  private init(activeIndex: number, isSearch: boolean = false) {\r\n    console.log('初始化数据当前activeIndex:', activeIndex)\r\n    this.maintenanceStatus = activeIndex\r\n    this.isSearch = isSearch\r\n    const params = {\r\n      auditStatus: activeIndex,\r\n      page: this.page,\r\n      pageSize: this.pageSize,\r\n      deviceName: this.deviceName,\r\n      startTime: this.valueTime && this.valueTime.length ? this.valueTime[0] : null,\r\n      completeTime: this.valueTime && this.valueTime.length ? this.valueTime[1] : null,\r\n    }\r\n    \r\n    getMaintenanceTaskPage(params).then(res => {\r\n      if (res.data.code === 1) {\r\n\r\n        this.tableData = res.data.data.records || 0\r\n        this.counts = res.data.total\r\n      } else {\r\n        this.$message.error(res.data.msg || '获取数据失败')\r\n      }\r\n    }).catch(() => {\r\n      // 模拟数据，实际开发中可删除\r\n      this.$message.error('未知错误请联系管理员')\r\n    })\r\n  }\r\n  \r\n  // 初始化函数（用于回车搜索）\r\n  private initFun(status: number) {\r\n    this.init(status, true)\r\n  }\r\n  \r\n  //管理标签页点击事件\r\n  change(activeIndex) {\r\n    if (activeIndex === this.maintenanceStatus) return\r\n    this.init(activeIndex)\r\n    this.valueTime = []\r\n    //this.dialogPurchaseStatus = 0\r\n    this.$router.push('/sectionLeader/deviceReview/maintenanceAcceptance')\r\n    console.log(activeIndex, '接收到了子组件的index')\r\n  }\r\n\r\n  \r\n  // 处理页码变化\r\n  private handleCurrentChange(val: number) {\r\n    this.page = val\r\n    this.init(this.maintenanceStatus)\r\n  }\r\n  \r\n  // 处理每页条数变化\r\n  private handleSizeChange(val: number) {\r\n    this.pageSize = val\r\n    this.page = 1\r\n    this.init(this.maintenanceStatus)\r\n  }\r\n  \r\n  // 关闭弹窗\r\n  private handleClose() {\r\n    this.dialogVisible = false\r\n  }\r\n  \r\n\r\n  \r\n  // 查看详情\r\n  private goDetail(maintenanceId: string, status: number, row: any = {}) {\r\n    this.row = row\r\n    this.dialogmaintenanceStatus = status\r\n    this.dialogVisible = true\r\n    \r\n    // 获取保养详情\r\n    queryMaintenanceDetailById(maintenanceId).then(res => {\r\n      if (res.data.code === 1) {\r\n        this.diaForm = res.data.data\r\n      } else {\r\n        this.$message.error(res.data.msg || '获取详情失败')\r\n      }\r\n    }).catch(() => {\r\n      // 模拟数据，实际开发中可删除\r\n      this.$message.error('未知错误请联系管理员')\r\n    })\r\n  }\r\n  \r\n  // 审核保养\r\n  private auditMaintenance2(row: any) {\r\n    this.row = row\r\n    this.dialogmaintenanceStatus = row.status\r\n    this.auditDialogVisible = true\r\n    // 获取保养详情\r\n    queryMaintenanceDetailById(row.maintenanceId).then(res => {\r\n      if (res.data.code === 1) {\r\n        this.diaForm = res.data.data\r\n      } else {\r\n        this.$message.error(res.data.msg || '获取详情失败')\r\n      }\r\n    }).catch(() => {\r\n      // 模拟数据，实际开发中可删除\r\n      this.$message.error('未知错误请联系管理员')\r\n    })\r\n  }\r\n  \r\n  // 审核不通过\r\n  private refuseFault(row: any) {\r\n    this.row = row\r\n    this.refuseDialogVisible = true\r\n  }\r\n  \r\n  // 确认审核不通过\r\n  private confirmRefuse() {\r\n    if (!this.refuseReason) {\r\n      this.$message.error('请选择审核不通过原因')\r\n      return\r\n    }\r\n    \r\n   \r\n    const params = {\r\n      approved: false,\r\n      maintenanceId: this.row.maintenanceId,\r\n      satisfactionScore: null,\r\n      verifyId: 1,\r\n      verifyOpinion: this.remark == '' ? this.refuseReason : this.remark,\r\n    };\r\n    \r\n    auditMaintenance2(params).then(res => {\r\n      if (res.data.code === 1) {\r\n        this.$message.success('审核通过成功！')\r\n        this.clearDialogVisible = false\r\n        this.dialogVisible = false\r\n        this.refuseDialogVisible = false\r\n        this.auditDialogVisible = false\r\n        this.remark = ''\r\n        this.row = {}\r\n        this.init(this.maintenanceStatus)\r\n      } else {\r\n        this.$message.error(res.data.msg || '操作失败')\r\n      }\r\n    }).catch(() => {\r\n      this.$message.error('服务器繁忙')\r\n      this.clearDialogVisible = false\r\n      this.dialogVisible = false\r\n      this.remark = ''\r\n      this.init(this.maintenanceStatus)\r\n    })\r\n  }\r\n  \r\n\r\n  \r\n  // 审核通过确认框\r\n  private confirmPassAudit(row: any) {\r\n    this.row = row\r\n    this.clearDialogVisible = true\r\n  }\r\n  \r\n  // 确认审核通过！\r\n  private passAudit() {\r\n    if (!this.remark) {\r\n      this.$message.error('请填写销号备注')\r\n      return;\r\n    }\r\n\r\n\r\n    const params = {\r\n      approved: true,\r\n      maintenanceId: this.row.maintenanceId,\r\n      satisfactionScore: null,\r\n      verifyId: 1,\r\n      verifyOpinion: this.remark,\r\n    };\r\n    \r\n    auditMaintenance2(params).then(res => {\r\n      if (res.data.code === 1) {\r\n        this.$message.success('审核通过成功！')\r\n        this.clearDialogVisible = false\r\n        this.dialogVisible = false\r\n        this.auditDialogVisible = false\r\n        this.remark = ''\r\n        this.row = {}\r\n        this.init(this.maintenanceStatus)\r\n      } else {\r\n        this.$message.error(res.data.msg || '操作失败')\r\n      }\r\n    }).catch(() => {\r\n      this.$message.success('销号成功')\r\n      this.clearDialogVisible = false\r\n      this.dialogVisible = false\r\n      this.remark = ''\r\n      this.init(this.maintenanceStatus)\r\n    })\r\n  }\r\n  \r\n  // 查看任务信息\r\n  private viewTaskInfo(row: any) {\r\n    this.taskDialogVisible = true\r\n    // 获取任务信息\r\n    queryMaintenanceTaskById(row.maintenanceId).then(res => {\r\n      if (res.data.code === 1) {\r\n        this.taskForm = res.data.data\r\n      } else {\r\n        this.$message.error(res.data.msg || '获取任务信息失败')\r\n      }\r\n    }).catch(() => {\r\n      // 模拟任务数据\r\n      this.taskForm = {\r\n        taskId: 1,\r\n        taskCode: 'TASK20230001',\r\n        maintenanceId: row.maintenanceId,\r\n        maintenanceCode: row.maintenanceCode,\r\n        deviceId: row.deviceId,\r\n        deviceCode: row.deviceCode,\r\n        deviceName: row.deviceName,\r\n        taskName: '设备保养维修任务',\r\n        startTime: '2023-05-10 10:00:00',\r\n        endTime: '2023-05-10 18:00:00',\r\n        executorId: 2001,\r\n        executorName: '李四',\r\n        status: 2,\r\n        completeTime: '2023-05-10 16:30:00',\r\n        closeTime: null,\r\n        areaId: row.areaId,\r\n        teamId: row.teamId,\r\n        createTime: '2023-05-10 09:45:00',\r\n        updateTime: '2023-05-10 16:30:00'\r\n      }\r\n    })\r\n  }\r\n  \r\n  // 关闭任务信息弹窗\r\n  private handleTaskClose() {\r\n    this.taskDialogVisible = false\r\n    this.taskForm = {}\r\n  }\r\n  \r\n  // 关闭审核弹窗\r\n  private handleAuditClose() {\r\n    this.auditDialogVisible = false\r\n    this.diaForm = {}\r\n  }\r\n}\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n.dashboard-container {\r\n  padding: 20px;\r\n  \r\n  .container {\r\n    background: #fff;\r\n    position: relative;\r\n    z-index: 1;\r\n    margin-top: 20px;\r\n    border-radius: 4px;\r\n    padding: 28px 36px;\r\n    min-height: calc(100vh - 200px);\r\n    \r\n    .tableBar {\r\n      margin-bottom: 20px;\r\n      display: flex;\r\n      justify-content: flex-start;\r\n      align-items: center;\r\n      \r\n      .el-input {\r\n        margin-right: 10px;\r\n      }\r\n      \r\n      .el-button {\r\n        margin-left: 20px;\r\n      }\r\n    }\r\n    \r\n    .tableBox {\r\n      width: 100%;\r\n      margin-bottom: 20px;\r\n      \r\n      .el-table-column {\r\n        text-align: center;\r\n      }\r\n    }\r\n    \r\n    .pageList {\r\n      text-align: center;\r\n      margin-top: 20px;\r\n    }\r\n  }\r\n  \r\n  .order-dialog {\r\n    .order-top {\r\n      padding-bottom: 20px;\r\n      border-bottom: 1px solid #efefef;\r\n      \r\n      .order-num {\r\n        display: inline-block;\r\n        font-size: 20px;\r\n        color: #333;\r\n        margin-left: 10px;\r\n      }\r\n      \r\n      .order-status {\r\n        float: right;\r\n        padding: 5px 10px;\r\n        border-radius: 4px;\r\n        background-color: #409EFF;\r\n        color: #fff;\r\n      }\r\n    }\r\n    \r\n    .order-middle {\r\n      padding: 20px 0;\r\n      border-bottom: 1px solid #efefef;\r\n      \r\n      .dish-label {\r\n        font-size: 18px;\r\n        color: #333;\r\n        margin-bottom: 10px;\r\n        font-weight: bold;\r\n      }\r\n      \r\n      .user-info {\r\n        margin-bottom: 20px;\r\n        \r\n        .user-info-box {\r\n          display: flex;\r\n          flex-wrap: wrap;\r\n          \r\n          > div {\r\n            width: 50%;\r\n            margin-bottom: 10px;\r\n            \r\n            label {\r\n              color: #666;\r\n              margin-right: 10px;\r\n            }\r\n          }\r\n        }\r\n        \r\n        .user-remark {\r\n          margin-top: 10px;\r\n          \r\n          > div {\r\n            color: #666;\r\n            margin-bottom: 5px;\r\n          }\r\n        }\r\n      }\r\n    }\r\n    \r\n    .order-bottom {\r\n      padding-top: 20px;\r\n      \r\n      .amount-label {\r\n        font-size: 18px;\r\n        color: #333;\r\n        margin-bottom: 10px;\r\n        font-weight: bold;\r\n      }\r\n      \r\n      .amount-info {\r\n        .approver-time {\r\n          display: flex;\r\n          margin-bottom: 5px;\r\n          \r\n          > div {\r\n            color: #666;\r\n            margin-right: 10px;\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n  \r\n  .cancelDialog {\r\n    .el-textarea {\r\n      width: 100%;\r\n    }\r\n  }\r\n}\r\n\r\n.operate {\r\n  min-width: 130px;\r\n}\r\n\r\n.otherOperate {\r\n  min-width: 140px;\r\n}\r\n\r\n.blueBug {\r\n  color: #409EFF;\r\n}\r\n\r\n.greenBug {\r\n  color: #67C23A;\r\n}\r\n\r\n.delBut {\r\n  color: #f56c6c;\r\n}\r\n\r\n.non {\r\n  margin-left: 0;\r\n}\r\n\r\n.before,\r\n.middle,\r\n.after {\r\n  display: inline-block;\r\n}\r\n.photo-container {\r\n  display: flex;\r\n  flex-wrap: wrap;\r\n  margin-top: 10px;\r\n  \r\n  .photo-item {\r\n    width: 120px;\r\n    height: 120px;\r\n    margin-right: 10px;\r\n    margin-bottom: 10px;\r\n    border: 1px solid #eee;\r\n    overflow: hidden;\r\n    \r\n    img {\r\n      width: 100%;\r\n      height: 100%;\r\n      object-fit: cover;\r\n    }\r\n  }\r\n}\r\n</style>"]}]}