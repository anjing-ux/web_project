{"remainingRequest":"G:\\device-management\\project-sky-admin-vue-ts\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!G:\\device-management\\project-sky-admin-vue-ts\\src\\views\\sectionLeader\\inform.vue?vue&type=style&index=0&id=687d9b38&lang=scss&scoped=true&","dependencies":[{"path":"G:\\device-management\\project-sky-admin-vue-ts\\src\\views\\sectionLeader\\inform.vue","mtime":1748971582589},{"path":"G:\\device-management\\project-sky-admin-vue-ts\\node_modules\\css-loader\\index.js","mtime":499162500000},{"path":"G:\\device-management\\project-sky-admin-vue-ts\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":499162500000},{"path":"G:\\device-management\\project-sky-admin-vue-ts\\node_modules\\postcss-loader\\src\\index.js","mtime":499162500000},{"path":"G:\\device-management\\project-sky-admin-vue-ts\\node_modules\\sass-loader\\dist\\cjs.js","mtime":499162500000},{"path":"G:\\device-management\\project-sky-admin-vue-ts\\node_modules\\style-resources-loader\\lib\\index.js","mtime":499162500000},{"path":"G:\\device-management\\project-sky-admin-vue-ts\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"G:\\device-management\\project-sky-admin-vue-ts\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\r\n.dashboard-container {\r\n  padding: 20px;\r\n  \r\n  .container {\r\n    background: #fff;\r\n    position: relative;\r\n    z-index: 1;\r\n    margin-top: 20px;\r\n    border-radius: 4px;\r\n    padding: 28px 36px;\r\n    min-height: calc(100vh - 200px);\r\n    \r\n    .tableBar {\r\n      margin-bottom: 20px;\r\n      display: flex;\r\n      justify-content: flex-start;\r\n      align-items: center;\r\n      \r\n      .el-input {\r\n        margin-right: 10px;\r\n      }\r\n      \r\n      .el-button {\r\n        margin-left: 20px;\r\n      }\r\n    }\r\n    \r\n    .tableBox {\r\n      width: 100%;\r\n      margin-bottom: 20px;\r\n      \r\n      .tableAction {\r\n        .el-button {\r\n          padding: 5px 0;\r\n          margin: 0 5px;\r\n        }\r\n      }\r\n    }\r\n    \r\n    .pageList {\r\n      text-align: center;\r\n      margin-top: 20px;\r\n    }\r\n  }\r\n}\r\n\r\n.blueBug {\r\n  color: #409EFF;\r\n}\r\n",{"version":3,"sources":["inform.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA6QA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA","file":"inform.vue","sourceRoot":"src/views/sectionLeader","sourcesContent":["<template>\r\n  <div class=\"dashboard-container\">\r\n    <div class=\"container\">\r\n      <div class=\"tableBar\">\r\n        <label style=\"margin-right: 10px\">消息类型：</label>\r\n        <el-select v-model=\"messageType\" placeholder=\"请选择\" style=\"width: 14%\" clearable @clear=\"init\">\r\n          <el-option\r\n            v-for=\"item in messageTypeList\"\r\n            :key=\"item.value\"\r\n            :label=\"item.label\"\r\n            :value=\"item.value\"\r\n          />\r\n        </el-select>\r\n        <label style=\"margin-right: 10px; margin-left: 20px\">状态：</label>\r\n        <el-select v-model=\"status\" placeholder=\"请选择\" style=\"width: 14%\" clearable @clear=\"init\">\r\n          <el-option\r\n            v-for=\"item in statusList\"\r\n            :key=\"item.value\"\r\n            :label=\"item.label\"\r\n            :value=\"item.value\"\r\n          />\r\n        </el-select>\r\n        <el-button type=\"primary\" @click=\"init\" style=\"margin-left: 20px\">查询</el-button>\r\n        <el-button type=\"primary\" @click=\"markAllRead\" style=\"margin-left: 10px\">全部已读</el-button>\r\n      </div>\r\n      <el-table v-if=\"tableData.length\" :data=\"tableData\" stripe class=\"tableBox\">\r\n        <el-table-column key=\"messageId\" prop=\"messageId\" label=\"消息ID\" />\r\n        <el-table-column key=\"type\" prop=\"type\" label=\"消息类型\">\r\n          <template slot-scope=\"{ row }\">\r\n            <span>{{ getMessageType(row) }}</span>\r\n          </template>\r\n        </el-table-column>\r\n        <el-table-column key=\"content\" prop=\"content\" label=\"消息内容\" />\r\n        <el-table-column key=\"createTime\" prop=\"createTime\" label=\"创建时间\" />\r\n        <el-table-column key=\"status\" prop=\"status\" label=\"状态\">\r\n          <template slot-scope=\"{ row }\">\r\n            <span>{{ getStatus(row) }}</span>\r\n          </template>\r\n        </el-table-column>\r\n        <el-table-column label=\"操作\" width=\"160\">\r\n          <template slot-scope=\"{ row }\">\r\n            <div class=\"tableAction\">\r\n              <el-button\r\n                v-if=\"row.status === 0\"\r\n                type=\"text\"\r\n                class=\"blueBug\"\r\n                @click=\"markRead(row)\"\r\n              >\r\n                标记已读\r\n              </el-button>\r\n              <el-button\r\n                type=\"text\"\r\n                class=\"blueBug\"\r\n                @click=\"handleMessage(row)\"\r\n              >\r\n                处理\r\n              </el-button>\r\n            </div>\r\n          </template>\r\n        </el-table-column>\r\n      </el-table>\r\n      <Empty v-else :is-search=\"isSearch\" />\r\n      <el-pagination\r\n        v-if=\"counts > 10\"\r\n        class=\"pageList\"\r\n        :page-sizes=\"[10, 20, 30, 40]\"\r\n        :page-size=\"pageSize\"\r\n        layout=\"total, sizes, prev, pager, next, jumper\"\r\n        :total=\"counts\"\r\n        @size-change=\"handleSizeChange\"\r\n        @current-change=\"handleCurrentChange\"\r\n      />\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script lang=\"ts\">\r\nimport { Component, Vue } from 'vue-property-decorator'\r\nimport { getInformData, batchMsg, setStatus } from '@/api/inform'\r\nimport Empty from '@/components/Empty/index.vue'\r\n\r\n@Component({\r\n  name: 'Inform',\r\n  components: {\r\n    Empty\r\n  }\r\n})\r\nexport default class extends Vue {\r\n  private tableData: any[] = []\r\n  private messageType = ''\r\n  private status = ''\r\n  private page = 1\r\n  private pageSize = 10\r\n  private counts = 0\r\n  private isSearch = false\r\n\r\n  // 消息类型列表\r\n  private messageTypeList = [\r\n    {\r\n      value: 1,\r\n      label: '待审核'\r\n    },\r\n    {\r\n      value: 2,\r\n      label: '催单'\r\n    },\r\n    {\r\n      value: 3,\r\n      label: '故障报修'\r\n    },\r\n    {\r\n      value: 4,\r\n      label: '维护保养'\r\n    },\r\n    {\r\n      value: 5,\r\n      label: '巡检验收'\r\n    },\r\n    {\r\n      value: 6,\r\n      label: '检测验收'\r\n    }\r\n  ]\r\n\r\n  // 状态列表\r\n  private statusList = [\r\n    {\r\n      value: 0,\r\n      label: '未读'\r\n    },\r\n    {\r\n      value: 1,\r\n      label: '已读'\r\n    }\r\n  ]\r\n\r\n  created() {\r\n    this.init()\r\n  }\r\n\r\n  // 初始化获取数据\r\n  private init() {\r\n    this.getList()\r\n  }\r\n\r\n  // 获取消息列表\r\n  private getList() {\r\n    this.isSearch = true\r\n    getInformData({\r\n      page: this.page,\r\n      pageSize: this.pageSize,\r\n      type: this.messageType,\r\n      status: this.status\r\n    })\r\n      .then(res => {\r\n        if (res.data.code === 1) {\r\n          this.tableData = res.data.data.records || []\r\n          this.counts = res.data.data.total\r\n        } else {\r\n          this.$message.error(res.data.msg || '获取消息列表失败')\r\n        }\r\n      })\r\n      .catch(() => {\r\n        this.$message.error('未知错误请联系管理员')\r\n      })\r\n  }\r\n\r\n  // 获取消息类型文本\r\n  private getMessageType(row: any) {\r\n    const item = this.messageTypeList.find(item => item.value === row.type)\r\n    return item ? item.label : '未知类型'\r\n  }\r\n\r\n  // 获取状态文本\r\n  private getStatus(row: any) {\r\n    const item = this.statusList.find(item => item.value === row.status)\r\n    return item ? item.label : '未知状态'\r\n  }\r\n\r\n  // 标记已读\r\n  private markRead(row: any) {\r\n    setStatus(row.messageId)\r\n      .then(res => {\r\n        if (res.data.code === 1) {\r\n          this.$message.success('标记已读成功')\r\n          this.getList()\r\n        } else {\r\n          this.$message.error(res.data.msg || '操作失败')\r\n        }\r\n      })\r\n      .catch(() => {\r\n        this.$message.error('未知错误请联系管理员')\r\n      })\r\n  }\r\n\r\n  // 全部标记已读\r\n  private markAllRead() {\r\n    batchMsg({})\r\n      .then(res => {\r\n        if (res.data.code === 1) {\r\n          this.$message.success('全部标记已读成功')\r\n          this.getList()\r\n        } else {\r\n          this.$message.error(res.data.msg || '操作失败')\r\n        }\r\n      })\r\n      .catch(() => {\r\n        this.$message.error('未知错误请联系管理员')\r\n      })\r\n  }\r\n\r\n  // 处理消息\r\n  private handleMessage(row: any) {\r\n    // 根据消息类型跳转到不同页面\r\n    switch (row.type) {\r\n      case 1: // 待审核\r\n        if (row.faultId) {\r\n          this.$router.push(`/sectionLeader/deviceReview/faultClear?faultId=${row.faultId}`)\r\n        } else if (row.maintenanceId) {\r\n          this.$router.push(`/sectionLeader/deviceReview/maintenanceAcceptance?maintenanceId=${row.maintenanceId}`)\r\n        } else if (row.inspectionId) {\r\n          this.$router.push(`/sectionLeader/deviceReview/inspectionAcceptance?inspectionId=${row.inspectionId}`)\r\n        } else if (row.detectionId) {\r\n          this.$router.push(`/sectionLeader/deviceReview/testingAcceptance?detectionId=${row.detectionId}`)\r\n        }\r\n        break\r\n      case 2: // 催单\r\n        if (row.purchaseId) {\r\n          this.$router.push(`/sectionLeader/purchase?purchaseId=${row.purchaseId}`)\r\n        } else if (row.outboundId) {\r\n          this.$router.push(`/sectionLeader/outbound?outboundId=${row.outboundId}`)\r\n        }\r\n        break\r\n      case 3: // 故障报修\r\n        this.$router.push(`/sectionLeader/deviceReview/faultClear?faultId=${row.faultId}`)\r\n        break\r\n      case 4: // 维护保养\r\n        this.$router.push(`/sectionLeader/deviceReview/maintenanceAcceptance?maintenanceId=${row.maintenanceId}`)\r\n        break\r\n      case 5: // 巡检验收\r\n        this.$router.push(`/sectionLeader/deviceReview/inspectionAcceptance?inspectionId=${row.inspectionId}`)\r\n        break\r\n      case 6: // 检测验收\r\n        this.$router.push(`/sectionLeader/deviceReview/testingAcceptance?detectionId=${row.detectionId}`)\r\n        break\r\n      default:\r\n        this.$message.warning('无法处理该类型消息')\r\n    }\r\n\r\n    // 如果消息未读，标记为已读\r\n    if (row.status === 0) {\r\n      this.markRead(row)\r\n    }\r\n  }\r\n\r\n  // 分页相关方法\r\n  private handleSizeChange(val: number) {\r\n    this.pageSize = val\r\n    this.init()\r\n  }\r\n\r\n  private handleCurrentChange(val: number) {\r\n    this.page = val\r\n    this.init()\r\n  }\r\n}\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n.dashboard-container {\r\n  padding: 20px;\r\n  \r\n  .container {\r\n    background: #fff;\r\n    position: relative;\r\n    z-index: 1;\r\n    margin-top: 20px;\r\n    border-radius: 4px;\r\n    padding: 28px 36px;\r\n    min-height: calc(100vh - 200px);\r\n    \r\n    .tableBar {\r\n      margin-bottom: 20px;\r\n      display: flex;\r\n      justify-content: flex-start;\r\n      align-items: center;\r\n      \r\n      .el-input {\r\n        margin-right: 10px;\r\n      }\r\n      \r\n      .el-button {\r\n        margin-left: 20px;\r\n      }\r\n    }\r\n    \r\n    .tableBox {\r\n      width: 100%;\r\n      margin-bottom: 20px;\r\n      \r\n      .tableAction {\r\n        .el-button {\r\n          padding: 5px 0;\r\n          margin: 0 5px;\r\n        }\r\n      }\r\n    }\r\n    \r\n    .pageList {\r\n      text-align: center;\r\n      margin-top: 20px;\r\n    }\r\n  }\r\n}\r\n\r\n.blueBug {\r\n  color: #409EFF;\r\n}\r\n</style>"]}]}